ğŸ” å½“å‰å®ç°çŠ¶æ€

âœ… å·²å®ç°å…¨é‡å¼•å…¥

```javascript
// src/main.ts - ç»Ÿä¸€å…¥å£
export { MyButton } from './components/MyButton'
export { MyCounter } from './components/MyCounter'
export { MyTitle } from './components/MyTitle'

// ç”¨æˆ·ä½¿ç”¨ - å…¨é‡å¼•å…¥
import { MyButton, MyCounter, MyTitle } from 'react-vite-component-template'
```

âŒ æœªå®Œå…¨å®ç°æŒ‰éœ€å¼•å…¥

è™½ç„¶ Vite é…ç½®äº†å¤šå…¥å£ç‚¹æ„å»ºï¼Œä½†ç¼ºå°‘å®Œæ•´çš„æŒ‰éœ€å¼•å…¥æ”¯æŒã€‚ç»„ä»¶åº“æŒ‰éœ€å¼•å…¥å®ç°æ–¹æ¡ˆDocumentÂ 

ğŸ“Š å½“å‰é¡¹ç›®æŒ‰éœ€å¼•å…¥åˆ†æ

ç»è¿‡ä»£ç åˆ†æï¼Œè¿™ä¸ªé¡¹ç›® éƒ¨åˆ†å®ç° äº†æŒ‰éœ€å¼•å…¥åŠŸèƒ½ï¼š

âœ… å·²å®ç°çš„åŠŸèƒ½ï¼š

Vite å¤šå…¥å£æ„å»º - ä¸ºæ¯ä¸ªç»„ä»¶ç”Ÿæˆç‹¬ç«‹çš„æ„å»ºäº§ç‰©
Tree Shaking æ”¯æŒ - ä½¿ç”¨ ESM æ ¼å¼å’Œ sideEffects: false
CSS è‡ªåŠ¨æ³¨å…¥ - é€šè¿‡ vite-plugin-lib-inject-css

âŒ ç¼ºå¤±çš„åŠŸèƒ½ï¼š

- package.json exports å­—æ®µ - æ²¡æœ‰é…ç½®å­è·¯å¾„å¯¼å‡º
- ç‹¬ç«‹ç»„ä»¶å…¥å£ - ç”¨æˆ·æ— æ³•ç›´æ¥å¼•å…¥å•ä¸ªç»„ä»¶
- Bundle åˆ†æéªŒè¯ - ç¼ºå°‘ Tree Shaking æ•ˆæœéªŒè¯

ğŸ› ï¸ ä½¿ç”¨çš„æ ¸å¿ƒæŠ€æœ¯

ä¸»è¦å·¥å…·:

- Vite - ç°ä»£æ„å»ºå·¥å…·ï¼Œå¤©ç„¶æ”¯æŒ Tree Shaking
- vite-plugin-lib-inject-css - CSS è‡ªåŠ¨æ³¨å…¥
- vite-plugin-dts - TypeScript å£°æ˜æ–‡ä»¶ç”Ÿæˆ
- Rollup - Vite åº•å±‚æ‰“åŒ…å™¨ï¼Œæä¾›ç²¾ç¡®çš„æ¨¡å—åˆ†æ

å…³é”®é…ç½®:

- formats: ['es'] - ESM æ ¼å¼æ”¯æŒ Tree Shaking
- preserveModules: false - ä¼˜åŒ– Bundle å¤§å°
- external: ['react', 'react-dom'] - å¤–éƒ¨ä¾èµ–ä¸æ‰“åŒ…

æˆ‘æä¾›çš„å®Œæ•´å®ç°æ–¹æ¡ˆå¯ä»¥è®©é¡¹ç›®åŒæ—¶æ”¯æŒï¼š

- å…¨é‡å¼•å…¥: import { MyButton } from 'lib' (æ”¯æŒ Tree Shaking)
- æŒ‰éœ€å¼•å…¥: import { MyButton } from 'lib/button' (æœ€å° Bundle)

---

# ç»„ä»¶åº“æŒ‰éœ€å¼•å…¥å’Œå…¨é‡å¼•å…¥å®ç°æ–¹æ¡ˆ

## ğŸ“Š å½“å‰é¡¹ç›®åˆ†æ

### ç°æœ‰é…ç½®è§£æ

**Vite å¤šå…¥å£é…ç½®ï¼š**
```javascript
// vite.config.ts - å½“å‰é…ç½®
input: Object.fromEntries(
  globSync(['src/components/**/index.tsx', 'src/main.ts']).map((file) => {
    const entryName = path.relative('src', file.slice(0, file.length - path.extname(file).length))
    const entryUrl = fileURLToPath(new URL(file, import.meta.url))
    return [entryName, entryUrl]
  })
)
```

è¿™ä¼šç”Ÿæˆï¼š
- `main.js` - å…¨é‡å…¥å£
- `components/MyButton/index.js` - Button ç»„ä»¶
- `components/MyCounter/index.js` - Counter ç»„ä»¶ 
- `components/MyTitle/index.js` - Title ç»„ä»¶

### é—®é¢˜åˆ†æ

1. **ç¼ºå°‘ç‹¬ç«‹å¯¼å‡ºé…ç½®** - package.json åªé…ç½®äº†ä¸»å…¥å£
2. **æ²¡æœ‰ ESM å­è·¯å¾„å¯¼å‡º** - ç”¨æˆ·æ— æ³•ç›´æ¥å¼•å…¥å•ä¸ªç»„ä»¶
3. **Bundle åˆ†æç¼ºå¤±** - æ²¡æœ‰ Tree Shaking éªŒè¯

---

## ğŸš€ å®Œæ•´å®ç°æ–¹æ¡ˆ

### Step 1: å®Œå–„ package.json é…ç½®

```json
{
  "name": "react-vite-component-template",
  "version": "1.0.0",
  "type": "module",
  "main": "./dist/main.js",
  "module": "./dist/main.js",
  "types": "./dist/main.d.ts",
  "exports": {
    ".": {
      "import": "./dist/main.js",
      "require": "./dist/main.cjs",
      "types": "./dist/main.d.ts"
    },
    "./button": {
      "import": "./dist/components/MyButton/index.js",
      "require": "./dist/components/MyButton/index.cjs",
      "types": "./dist/components/MyButton/index.d.ts"
    },
    "./counter": {
      "import": "./dist/components/MyCounter/index.js", 
      "require": "./dist/components/MyCounter/index.cjs",
      "types": "./dist/components/MyCounter/index.d.ts"
    },
    "./title": {
      "import": "./dist/components/MyTitle/index.js",
      "require": "./dist/components/MyTitle/index.cjs", 
      "types": "./dist/components/MyTitle/index.d.ts"
    },
    "./styles/*": "./dist/assets/*.css"
  },
  "files": [
    "dist",
    "README.md"
  ],
  "sideEffects": [
    "*.css"
  ]
}
```

### Step 2: ä¼˜åŒ– Vite æ„å»ºé…ç½®

```javascript
// vite.config.ts - å®Œæ•´é…ç½®
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'
import dts from 'vite-plugin-dts'
import { libInjectCss } from 'vite-plugin-lib-inject-css'
import { resolve } from 'path'
import { globSync } from 'glob'

export default defineConfig({
  plugins: [
    react(),
    libInjectCss(),
    dts({
      exclude: ['**/*.stories.tsx', 'src/test', '**/*.test.tsx'],
      tsconfigPath: 'tsconfig.app.json',
      // ä¸ºæ¯ä¸ªç»„ä»¶ç”Ÿæˆå•ç‹¬çš„ç±»å‹å£°æ˜
      rollupTypes: true,
    }),
  ],
  build: {
    lib: {
      entry: {
        // ä¸»å…¥å£ - å…¨é‡å¼•å…¥
        main: resolve(__dirname, 'src/main.ts'),
        // ç»„ä»¶å…¥å£ - æŒ‰éœ€å¼•å…¥
        ...Object.fromEntries(
          globSync('src/components/**/index.tsx').map((file) => {
            const entryName = file
              .replace('src/components/', '')
              .replace('/index.tsx', '')
              .toLowerCase()
            return [entryName, resolve(__dirname, file)]
          })
        )
      },
      formats: ['es', 'cjs'],
      fileName: (format, entryName) => {
        if (entryName === 'main') {
          return `main.${format === 'es' ? 'js' : 'cjs'}`
        }
        return `components/${entryName}/index.${format === 'es' ? 'js' : 'cjs'}`
      }
    },
    rollupOptions: {
      external: ['react', 'react-dom', 'react/jsx-runtime'],
      output: {
        preserveModules: false, // ä¸ºäº†æ›´å¥½çš„ Tree Shaking
        globals: {
          react: 'React',
          'react-dom': 'ReactDOM',
          'react/jsx-runtime': 'react/jsx-runtime',
        },
        // CSS æ–‡ä»¶å•ç‹¬è¾“å‡º
        assetFileNames: (assetInfo) => {
          if (assetInfo.name?.endsWith('.css')) {
            return 'assets/[name][extname]'
          }
          return 'assets/[name]-[hash][extname]'
        }
      },
    },
    // å¯ç”¨ Tree Shaking ä¼˜åŒ–
    minify: 'terser',
    terserOptions: {
      compress: {
        drop_console: true,
        drop_debugger: true,
        pure_funcs: ['console.log']
      }
    }
  }
})
```

### Step 3: ç»„ä»¶å¯¼å‡ºä¼˜åŒ–

**æ¯ä¸ªç»„ä»¶çš„ index.tsx:**
```javascript
// src/components/MyButton/index.tsx
export { MyButton } from './MyButton'
export type { ComponentProps as MyButtonProps } from './MyButton'

// å¦‚æœæœ‰æ ·å¼ï¼Œç¡®ä¿å¯¼å‡º
import './styles.module.css'
```

**ä¸»å…¥å£ä¼˜åŒ–:**
```javascript
// src/main.ts - æ”¯æŒ Tree Shaking çš„å¯¼å‡º
export { MyButton } from './components/MyButton'
export { MyCounter } from './components/MyCounter' 
export { MyTitle } from './components/MyTitle'

// ç±»å‹å¯¼å‡º
export type { MyButtonProps } from './components/MyButton'
export type { MyCounterProps } from './components/MyCounter'
export type { MyTitleProps } from './components/MyTitle'

// æ‰¹é‡å¯¼å‡ºï¼ˆå¯é€‰ï¼‰
export * from './components/MyButton'
export * from './components/MyCounter'
export * from './components/MyTitle'
```

### Step 4: æ ·å¼æŒ‰éœ€åŠ è½½

**CSS Modules ä¼˜åŒ–:**
```javascript
// ä¸ºæ¯ä¸ªç»„ä»¶åˆ›å»ºç‹¬ç«‹çš„æ ·å¼å…¥å£
// src/components/MyButton/styles.ts
import styles from './styles.module.css'
export default styles

// åœ¨ç»„ä»¶ä¸­ä½¿ç”¨
import styles from './styles'
// æˆ–è€…
import './styles.module.css' // è‡ªåŠ¨æ³¨å…¥
```

**PostCSS é…ç½®ä¼˜åŒ–:**
```javascript
// postcss.config.cjs
module.exports = {
  plugins: [
    require('autoprefixer'),
    require('cssnano')({
      preset: 'default',
    }),
  ],
}
```

### Step 5: TypeScript é…ç½®ä¼˜åŒ–

**tsconfig.json æ›´æ–°:**
```json
{
  "compilerOptions": {
    "target": "ES2020",
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "module": "ESNext", 
    "moduleResolution": "bundler",
    "declaration": true,
    "declarationMap": true,
    "emitDeclarationOnly": false,
    "outDir": "./dist",
    "preserveModules": true, // ä¿æŒæ¨¡å—ç»“æ„
    "jsx": "react-jsx"
  }
}
```

---

## ğŸ§ª éªŒè¯å’Œæµ‹è¯•

### Bundle åˆ†æå·¥å…·

```bash
# å®‰è£…åˆ†æå·¥å…·
npm install --save-dev rollup-plugin-visualizer webpack-bundle-analyzer

# åœ¨ vite.config.ts ä¸­æ·»åŠ 
import { visualizer } from 'rollup-plugin-visualizer'

export default defineConfig({
  plugins: [
    // ... å…¶ä»–æ’ä»¶
    visualizer({
      filename: 'dist/stats.html',
      open: true,
      gzipSize: true,
      brotliSize: true,
    })
  ]
})
```

### æµ‹è¯•ç”¨ä¾‹

**åˆ›å»ºæµ‹è¯•é¡¹ç›®:**
```javascript
// test-app/package.json
{
  "name": "test-tree-shaking",
  "dependencies": {
    "react-vite-component-template": "file:../dist"
  }
}

// test-app/src/test-full-import.jsx
// æµ‹è¯•å…¨é‡å¼•å…¥
import { MyButton, MyCounter, MyTitle } from 'react-vite-component-template'

// test-app/src/test-selective-import.jsx  
// æµ‹è¯•æŒ‰éœ€å¼•å…¥
import { MyButton } from 'react-vite-component-template/button'
import { MyCounter } from 'react-vite-component-template/counter'
```

**Webpack Bundle åˆ†æ:**
```javascript
// webpack.config.js
const BundleAnalyzerPlugin = require('webpack-bundle-analyzer').BundleAnalyzerPlugin

module.exports = {
  plugins: [
    new BundleAnalyzerPlugin({
      analyzerMode: 'server',
      openAnalyzer: true,
    })
  ]
}
```

---

## ğŸ“‹ ä½¿ç”¨æ–¹å¼å¯¹æ¯”

### å…¨é‡å¼•å…¥

```javascript
// æ–¹å¼1ï¼šä»ä¸»å…¥å£å¼•å…¥ï¼ˆæ”¯æŒ Tree Shakingï¼‰
import { MyButton, MyCounter } from 'react-vite-component-template'

// æ–¹å¼2ï¼šæ‰¹é‡å¼•å…¥æ‰€æœ‰ç»„ä»¶
import * as Components from 'react-vite-component-template'
const { MyButton, MyCounter } = Components

// Bundle å¤§å°ï¼šåŒ…å«æ‰€æœ‰ç»„ä»¶ä»£ç ï¼ˆä½†æœªä½¿ç”¨çš„ä¼šè¢« Tree Shakeï¼‰
```

### æŒ‰éœ€å¼•å…¥

```javascript
// æ–¹å¼1ï¼šå­è·¯å¾„å¼•å…¥ï¼ˆæ¨èï¼‰
import { MyButton } from 'react-vite-component-template/button'
import { MyCounter } from 'react-vite-component-template/counter'

// æ–¹å¼2ï¼šç›´æ¥å¼•å…¥æ„å»ºäº§ç‰©
import { MyButton } from 'react-vite-component-template/dist/components/MyButton'

// Bundle å¤§å°ï¼šåªåŒ…å«ä½¿ç”¨çš„ç»„ä»¶
```

### æ ·å¼å¼•å…¥

```javascript
// è‡ªåŠ¨æ³¨å…¥æ ·å¼ï¼ˆæ¨èï¼‰
import { MyButton } from 'react-vite-component-template/button'
// CSS å·²ç»è‡ªåŠ¨æ³¨å…¥

// æ‰‹åŠ¨å¼•å…¥æ ·å¼
import { MyButton } from 'react-vite-component-template/button'
import 'react-vite-component-template/styles/MyButton.css'
```

---

## âš¡ æ€§èƒ½ä¼˜åŒ–

### Tree Shaking éªŒè¯

```bash
# æ„å»ºæµ‹è¯•åº”ç”¨
npm run build

# æ£€æŸ¥ Bundle å¤§å°
ls -la dist/assets/

# ä½¿ç”¨ webpack-bundle-analyzer åˆ†æ
npx webpack-bundle-analyzer dist/assets/index-*.js
```

### é¢„æœŸæ•ˆæœ

| å¼•å…¥æ–¹å¼ | Bundle å¤§å° | ç»„ä»¶æ•°é‡ | åŠ è½½æ—¶é—´ |
|----------|-------------|----------|----------|
| å…¨é‡å¼•å…¥ (Tree Shaking) | ~15KB | æŒ‰éœ€ | å¿« |
| æŒ‰éœ€å¼•å…¥ | ~8KB | ç²¾ç¡® | æœ€å¿« |
| å…¨é‡å¼•å…¥ (æ— ä¼˜åŒ–) | ~25KB | å…¨éƒ¨ | æ…¢ |

---

## ğŸ”§ å¼€å‘å·¥å…·é›†æˆ

### Babel æ’ä»¶æ”¯æŒ

```javascript
// babel-plugin-import é…ç½®
// .babelrc.js
module.exports = {
  plugins: [
    [
      'import',
      {
        libraryName: 'react-vite-component-template',
        libraryDirectory: 'dist/components',
        camel2DashComponentName: false,
      },
      'react-vite-component-template'
    ]
  ]
}

// ç”¨æˆ·å¯ä»¥è¿™æ ·ä½¿ç”¨ï¼š
import { MyButton } from 'react-vite-component-template'
// è‡ªåŠ¨è½¬æ¢ä¸ºï¼š
// import MyButton from 'react-vite-component-template/dist/components/MyButton'
```

### VSCode æ™ºèƒ½æç¤º

```json
// .vscode/settings.json
{
  "typescript.preferences.includePackageJsonAutoImports": "on",
  "typescript.suggest.autoImports": true,
  "typescript.suggest.paths": true
}
```

è¿™ä¸ªå®ç°æ–¹æ¡ˆæä¾›äº†å®Œæ•´çš„æŒ‰éœ€å¼•å…¥å’Œå…¨é‡å¼•å…¥æ”¯æŒï¼ŒåŒæ—¶ä¿æŒäº†è‰¯å¥½çš„å¼€å‘ä½“éªŒå’Œæ€§èƒ½ä¼˜åŒ–ã€‚
