## 1. 切入页面、添加路由
1.1 新建 Login 文件夹，在文件夹内添加两个文件 index.jsx 和 style.module.less：
```shell
mkdir -p src/container/Login
```
1.2 src/container/Login/index.jsx文件添加以下内容：
```jsx
import React from 'react';

const Login = () => {
  return <div>注册</div>;
};

export default Login;
```
1.3 src/router/index.js文件添加Login页面路由如下：
```js
...
import Login from '@/container/Login'

const routes = [
    ...
    {
        path: "/login",
        component: Login
    }
];
```
此时`npm run dev`能够正确运行，浏览器打开http://localhost:5173/login ，显示注册。

## 2. 注册页静态页面
2.1 新增src/container/Login/index.jsx文件内容如下：
```jsx
import React from 'react';
import { Cell, Input, Button, Checkbox } from 'zarm';
import CustomIcon from '@/components/CustomIcon';

import s from './style.module.less';

const Login = () => {
  return (
    <div className={s.auth}>
      <div className={s.head} />
      <div className={s.tab}>
        <span>注册</span>
      </div>
      <div className={s.form}>
        <Cell icon={<CustomIcon type="zhanghao" />}>
          <Input clearable type="text" placeholder="请输入账号" />
        </Cell>
        <Cell icon={<CustomIcon type="mima" />}>
          <Input clearable type="password" placeholder="请输入密码" />
        </Cell>
        <Cell icon={<CustomIcon type="mima" />}>
          <Input clearable type="text" placeholder="请输入验证码" />
        </Cell>
      </div>
      <div className={s.operation}>
        <div className={s.agree}>
          <Checkbox />
          <label className="text-light">阅读并同意<a>《掘掘手札条款》</a></label>
        </div>
        <Button block theme="primary" onClick={onSubmit}>
          注册
        </Button>
      </div>
    </div>
  );
};

export default Login;
```
2.2 src/container/Login/style.module.less文件内容如下：
```less
.auth {
    min-height: 100vh;
    // background-color: #597fe7;
    background-image: linear-gradient(217deg, #6fb9f8, #3daaf85e, #49d3fc1a, #3fd3ff00);

    // background-image: linear-gradient(217deg, #ffda44, #346b935e, #1e9abf1a, #084d6200);
    .head {
        height: 200px;
        background: url('//s.yezgea02.com/1616032174786/cryptocurrency.png') no-repeat center;
        background-size: 120%;
        border-bottom-left-radius: 12px;
        border-bottom-right-radius: 12px;

        img {
            width: 34px;
            margin: 15px 0 0 15px;
        }
    }

    .tab {
        color: #597fe7;
        padding: 30px 24px 10px 24px;

        >span {
            margin-right: 10px;
            font-size: 14px;
            font-weight: bold;

            &.avtive {
                font-size: 20px;
                border-bottom: 2PX solid #597fe7;
                padding-bottom: 6px;
            }
        }
    }

    .form {
        padding: 0 6px;

        :global {
            .za-cell {
                background-color: transparent;

                &::after {
                    border-top: none;
                }
            }
        }
    }

    .operation {
        padding: 10px 24px 0 24px;

        .agree {
            display: flex;
            align-items: center;
            margin-bottom: 10px;

            label {
                margin-left: 10px;
                font-size: 14px;
            }
        }
    }
}
```
注意，样式编写部分，要注意的一点是 :global 这个关键词。由于我们采用的是 CSS Module 的形式进行开发，也就是在页面中声明的类名都会根据当前页面，打一个唯一的 hash 值。比如我们页面中声明的 className={s.form}，最终在浏览器中显示的类名是_form_kpur3_30，是已经被编译过的样式，这样做的目的是避免和别的页面的样式重名。

所以经过编译之后，想要修改 .form 下的 .za-cell，如下写法，将无法修改成功：

```css
.form {
  .za-cell {
    color: red;
  }
}
```

原因是，上述写法，.za-cell 会被编译加上 hash，组件库 Zarm 内的 dom 类名还是叫 za-cell。所以**采用 CSS Module 的形式进行开发，为了能够修改 .form 下的 .za-cell，不需要给.za-cell 编译一个 hash类名，就需要给.za-cell外层加上:global**，如下：

```css
.form {
  :global {
    .za-cell {
      color: red;
    }
  }
}
```
此时`npm run dev`能够看到静态页面内容。

## 3. 添加验证码插件
3.1 安装插件：`npm install react-simple-captcha`;

3.2 使用插件（详细可看：https://www.npmjs.com/package/react-simple-captcha）， 修改Login.jsx代码，如下：
```jsx
...
import React, { useState, useEffect } from 'react';
import {
    loadCaptchaEnginge,
    LoadCanvasTemplateNoReload
} from 'react-simple-captcha';
...

const Login = () => {

    useEffect(() => {
        loadCaptchaEnginge(4); // 加载4位验证码
    }, []);

    return (
        <div className={s.auth}>
            ...
            <div className={s.form}>
                ...
                <Cell icon={<CustomIcon type="mima" />}>
                    <Input clearable type="text" placeholder="请输入验证码" />
                    <div
                      className={s.captchaWrapper}
                      onClick={() => loadCaptchaEnginge(4)}
                    >
                      <LoadCanvasTemplateNoReload />
                    </div>
                </Cell>
                ...
            </div>
            ...
        </div>
    );
};
```

3.3 修改style.module.less文件，如下：
```
...
.form {
        padding: 0 6px;

        :global {
            .za-cell {
                background-color: transparent;

                ...
                .captchaWrapper {
                    display: inline-block;
                    cursor: pointer;
                }

                canvas {
                    vertical-align: middle;
                    border-radius: 4px;
                }
                ...

                &::after {
                    border-top: none;
                }
            }
        }
    }
...
```

## 4. 注册逻辑
3.1 当输入框内容修改时，onChange 会被触发，接受的回调函数参数，便是变化的输入值，此时我们将其保存在声明的变量中。我们在src/container/Login/index.jsx中input框添加onChange函数，添加声明保存账户、密码、验证码的变量如下：
```jsx
...
const [username, setUsername] = useState(''); // 账号
const [password, setPassword] = useState(''); // 密码
const [verify, setVerify] = useState(''); // 验证码
...
<Input
  clearable
  type="text"
  placeholder="请输入账号"
  onChange={(value) => setUsername(value)}
/>
...
<Input
  clearable
  type="password"
  placeholder="请输入密码"
  onChange={(value) => setPassword(value)}
/>
...
<Input
  clearable
  type="text"
  placeholder="请输入验证码"
  onChange={(value) => setVerify(value)}
/>
...
```
3.2 注册需要的参数账户、密码、验证码都清晰，我们开始编写注册方法，如下：
```jsx
import { 
    ...
    Toast 
} from 'zarm';

const Login = () => {
    ...
    const onSubmit = async () => {
        if (!username) {
          Toast.show('请输入账号')
          return
        }
        if (!password) {
          Toast.show('请输入密码')
          return
        }
        if (!verify) {
          Toast.show('请输入验证码')
          return
        };
        if (!validateCaptcha(verify)) {
            Toast.show('验证码错误')
            loadCaptchaEnginge(4); // 验证失败时重新加载验证码
            return;
        }
        try {
          const { data } = await post('/api/user/register', {
            username,
            password
          });
          Toast.show('注册成功');
        } catch (error) {
          Toast.show('系统错误');
        }
      };

    return (
        <div className={s.auth}>
            ...
            <div className={s.operation}>
                <div className={s.agree}>
                    <Checkbox />
                    <label className="text-light">阅读并同意<a>《掘掘手札条款》</a></label>
                </div>
                ...
                <Button block theme="primary" onClick={onSubmit}>
                    注册
                </Button>
                ...
            </div>
        </div>
    );
};
```
输入的验证码需要和验证码图片中验证码匹配，我们使用插件提供的`validteCaptcha`方法。

上述代码中，因为我们使用的是 async await 做异步处理，所以需要通过 try catch 来捕获异步处理过程中出现的错误，如果使用 Promise 的回调函数，则无需使用 try catch，如下代码（建议使用 async await）：
```jsx
post('/api/user/register', {
  username,
  password
}).then(res => {
  // do something
})
```










