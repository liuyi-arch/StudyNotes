### 一、使用 Vite 创建 Vue3 + TypeScript 项目

#### 1.1 全局安装 Vite

```bash
npm install -g create-vite
```

#### 1.2 创建项目

```bash
npm create vite@latest . -- --template vue-ts
```

若项目从0搭建，则是：

```bash
npm create vite@latest tdesign-mobile-vue-starter-community -- --template vue-ts
```

> 笔者从`https://cnb.cool/tencent/tdesign/tdesign-mobile-vue-starter-community.git`clone得到项目，已有项目根目录，所以不是后者创建项目方式。
>
> 其中， `.` 表示在当前目录初始化，而不是创建新目录。

#### 1.3 安装依赖、启动项目

```bash
npm install
npm run dev
```

#### 1.4 可能存在的一些问题

### 二、安装 TDesign Mobile Vue 及相关插件

#### 1. 安装 TDesign Mobile Vue 组件库

```bash 
npm install tdesign-mobile-vue
```

#### 2. 安装自动导入、自动按需引入、自动路由插件

```bash
npm install -D unplugin-auto-import unplugin-vue-components unplugin-vue-router
```

#### 3. 安装 Vue Router

```bash
npm install vue-router
```

#### 4. 安装 TypeScript 类型支持

```bash
npm install -D @types/node
```

#### 5. 安装 ESLint 及 antfu/eslint-config

```bash
npm install -D eslint @antfu/eslint-config
```

#### 6. 安装 Volar

在 VSCode 插件市场搜索并安装 Volar 插件。

#### 7. 关于Composition API 的 `<script setup>` 语法糖

1. 传统 Composition API：

```vue
<!-- MyButton.vue -->
<template>
  <button @click="increment">点击 {{ count }} 次</button>
</template>

<script lang="ts">
import { defineComponent, ref } from 'vue'

export default defineComponent({
  setup() {
    const count = ref(0)
    const increment = () => count.value++

    return {
      count,
      increment
    }
  }
})
</script>

<style scoped>
button {
  padding: 10px;
}
</style>
```

2. 使用 `<script setup>`（语法糖）：

```vue
<!-- MyButton.vue -->
<template>
  <button @click="count++">点击 {{ count }} 次</button>
</template>

<script setup lang="ts">
import { ref } from 'vue'

const count = ref(0)
</script>

<style scoped>
button {
  padding: 10px;
}
</style>
```

- **不需要 `defineComponent` 和 `setup()` 包裹**。
- **不需要手动 `return`变量和方法**，自动暴露给 `<template>` 使用。

### 三、配置 unplugin-vue-components、unplugin-auto-import

#### 1. 创建src/types目录

```bash
mkdir src/types
```

#### 2. 配置 vite.config.ts

在 `vite.config.ts`顶部引入下列插件：

```ts
import AutoImport from 'unplugin-auto-import/vite';
import { VueRouterAutoImports } from 'unplugin-vue-router'
import Components from 'unplugin-vue-components/vite';
import { TDesignResolver } from 'unplugin-vue-components/resolvers';
```

在 `vite.config.ts`文件`plugins` 数组中添加如下配置：

```ts
export default defineConfig({
  plugins: [
    vue(),
    AutoImport({
      resolvers: [TDesignResolver({
        library: 'mobile-vue'
      })],
      imports: [
        'vue',
        VueRouterAutoImports,
      ],
      dts: 'src/types/auto-imports.d.ts', // 自动生成的类型声明文件
      vueTemplate: true,
    }),
    Components({
      resolvers: [TDesignResolver({
        library: 'mobile-vue'
      })],
      dts: 'src/types/components.d.ts', // 自动生成的类型声明文件
    }),
  ],
});
```

#### 3. 配置tsconfig.app.json 的 include部分

`tsconfig.app.json` 中的 `include` 添加`.d.ts`字段，否则无法生成`.d.ts`文件：

```json
{
  "include": ["src/**/*.ts", "src/**/*.tsx", "src/**/*.vue", "src/**/*.d.ts"]
}
```

### 四、验证自动导入、自动按需引入是否成功配置

#### 1. 检验 `unplugin-auto-import` 是否工作

修改`src/components/HelloWorld.vue`文件内容如下：

```vue
<script setup lang="ts">
const count = ref(0)
</script>

<template>
  <div @click="count++">
    Count: {{ count }}
  </div>
</template>
```

`npm run dev`启动，没有手动 import `ref`，编译通过并运行正常。

#### 2. 检验 `unplugin-vue-components` 是否工作

`App.vue`文件替换如下内容：

```vue
<script setup lang="ts">
import HelloWorld from './components/HelloWorld.vue'
</script>

<template>
  <div class="row">
    <t-button size="large" theme="primary" block>填充按钮</t-button>
  </div>
  <HelloWorld msg="Vite + Vue" />
</template>

<style scoped>
.row {
  margin: 0 16px;
}
</style>
```

无需手动 import `TButton` ，页面能渲染出 TDesign 的按钮组件。

### 五、配置unplugin-vue-router

#### 1. 配置vite.config.ts

在 `vite.config.ts`文件`plugins`数组中添加如下内容：

```ts
plugins: [
    VueRouter({
      dts: 'src/types/typed-router.d.ts', // 自动生成路由类型声明
      routesFolder: 'src/pages', // 需在 src/pages 中创建页面组件
      extensions: ['.vue'], // 默认支持 .vue 文件
    }),
    // Vue must be placed after VueRouter()
    vue(),
    // ...
  ],
```

> 注意，Vue must be placed after VueRouter()

#### 2. 配置tsconfig.app.json

`tsconfig.app.json` 添加如下内容：

```json
"compilerOptions": {
// ...
	"moduleResolution": "Bundler",
// ...
},
```

#### 3. 配置env.d.ts

添加如下内容：

```ts
/// <reference types="unplugin-vue-router/client" />
```

#### 4. 关于`vue-router/auto`

`vue-router/auto`是一个“虚拟模块”（不是实际的 npm 包），是由 `unplugin-vue-router` 插件在编译阶段“模拟”出来的。

为了防止开发时误用 `vue-router/auto`，可以在 VSCode 的 `.vscode/settings.json` 文件中添加如下内容：

```json
{
  "typescript.tsdk": "node_modules/typescript/lib",
  "typescript.preferences.autoImportFileExcludePatterns": ["vue-router/auto$"]
}
```

> ⚠️ `vue-router/auto`将会被官方彻底移除！

#### 5. 配置src/router.ts

`src`目录下新建`router.ts`文件，添加下列内容：

```ts
import { createRouter, createWebHistory } from 'vue-router'
import { routes, handleHotUpdate } from 'vue-router/auto-routes'

export const router = createRouter({
  history: createWebHistory(),
  routes, 
})

// This will update routes at runtime without reloading the page
if (import.meta.hot) { 
  handleHotUpdate(router) 
} 
```

#### 6. 配置main.ts

`main.ts`文件中添加如下内容：

```ts
// ...
import { createRouter, createWebHistory } from 'vue-router'
import { routes } from 'vue-router/auto-routes'
// ...

const router = createRouter({
  history: createWebHistory(),
  routes,
})

createApp(App)
  .use(router)
  .mount('#app')
```

#### 7. 验证自动路由是否成功配置

新建`pages`目录，`unplugin-vue-router` 默认扫描 `src/pages` 目录下的页面组件自动生成路由。

```bash
mkdir src/pages
```

`pages`目录下新建`home.vue`文件，添加如下内容：

```vue
<template>
  <h1>Home</h1>
</template>
```

将组件挂载到`App.vue`中：

```vue
<template>
	<!-- ... -->
  <router-view />
	<!-- ... -->
</template>
```

`npm run dev`启动浏览器，访问 `/home` 能自动加载 `pages/Home.vue`， `unplugin-vue-router` 插件配置成功。

### 六、配置 ESLint（antfu/eslint-config）

#### 1. 配置ESLint 文件和.eslintignore忽略文件

项目根目录新建 `eslint.config.js`：

```bash
touch eslint.config.js
touch .eslintignore
```

`eslint.config.js`文件添加如下内容：

```js
import antfu from '@antfu/eslint-config'

export default antfu()
```

`.eslintignore`文件添加如下内容：

```eslintignore
dist
node_modules
types/**/*.d.ts
src/types/**/*.d.ts
vite.config.ts
tsconfig*.json
public/
```

#### 2. 添加 Lint 脚本命令

`package.json` 中添加以下脚本，为项目增加命令行快捷方式来运行**ESLint 检查和自动修复**：

```json
"scripts": {
  "lint": "eslint . --ext .js,.ts,.vue",
  "lint:fix": "eslint . --ext .js,.ts,.vue --fix"
}
```

- `npm run lint`等价于`eslint . --ext .js,.ts,.vue`：从当前目录检查扩展名为 `.js`、`.ts`、`.vue` 的文件；
- `npm run lint:fix`等价于`eslint . --ext .js,.ts,.vue --fix`；

#### 3. 测试ESLint 配置是否生效

执行 `lint` 命令检查能输出项目中违反 ESLint 规则的文件列表：

```bash
npm run lint
```

执行 `lint:fix` 命令能够自动修复项目中违反 ESLint 规则的部分内容：

```bash
npm run lint:fix
```

比如`App.vue`文件中添加比如`const msg = "qqq"`双引号，执行`npm run lint:fix`双引号修复为单引号，ESLint配置成功。

### 七、最终文件目录结构

```text
.                                     # 项目根目录
├── README.md                         # 项目说明文档
├── doc.md                            # 项目搭建记录文档
├── eslint.config.js                  # ESLint配置文件
├── index.html                        # 项目入口文件
├── package-lock.json                 # 依赖锁定文件
├── package.json                      # 项目依赖、脚本、元信息配置文件
├── public                            # 公共静态资源目录
│   └── vite.svg                     
├── src                               # 主源码目录
│   ├── App.vue                       # 根组件
│   ├── assets                        # 静态资源目录
│   │   └── vue.svg                   
│   ├── components                    # 通用组件目录
│   │   └── HelloWorld.vue            # 检验 `unplugin-auto-import` 是否工作
│   ├── layouts                       # 页面布局组件目录
│   ├── main.ts                       # 项目入口文件
│   ├── pages                         # 路由页面组件目录
│   │   ├── Login.vue                 # 登录页面
│   │   ├── Message.vue               # 消息页
│   │   ├── Profile.vue               # 个人信息页
│   │   ├── Settings.vue              # 设置页
│   │   └── home.vue                  # 首页
│   ├── router.ts                     # Vue Router 配置入口
│   ├── style.css                     # 全局样式文件
│   ├── styles                        # 样式模块目录（如变量、reset、mixin 等）
│   ├── types                         # 类型定义目录
│   │   ├── auto-imports.d.ts         # unplugin-auto-import 插件生成的全局 API 类型声明
│   │   ├── components.d.ts           # unplugin-vue-components 插件生成的全局组件类型声明
│   │   └── typed-router.d.ts         # unplugin-vue-router 插件生成的路由类型声明
│   ├── utils                         # 工具函数目录
│   └── vite-env.d.ts                 # Vite 提供的全局类型定义
├── tsconfig.app.json                 # 针对前端项目的 TS 配置文件（供编译使用）
├── tsconfig.json                     # 根 TS 配置，管理整体配置结构
├── tsconfig.node.json                # 针对 node 脚本或工具（如 vite.config.ts）的 TS 配置
└── vite.config.ts                    # Vite 的主配置文件
```

### 参考文献

1. 配置 unplugin-vue-components、unplugin-auto-import部分参考：https://tdesign.tencent.com/mobile-vue/getting-started（通过插件按需引用使用部分）
2. 配置unplugin-vue-router部分参考：https://uvr.esm.is/introduction.html
3. https://stackoverflow.com/questions/78898738/route-parameter-typing-error-with-typescript-and-unplugin-vue-router
