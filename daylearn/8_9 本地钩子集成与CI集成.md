## 一、ESLint、Prettier、Husky、lint-staged、CI/CD基本概念

Husky：用于设置 Git 钩子；

lint-staged：仅对已暂存的文件运行 lint 和格式化；

ESLint 和 Prettier：确保语义和格式统一；

CI（持续集成，Continuous Integration）是指将代码变更合并到主分支，会**触发自动化构建和测试流程**。

CD 持续交付（Continuous Delivery）和持续部署（Continuous Deployment），前者确保代码可以随时安全地部署到生产环境，后者则自动将变更部署到生产环境。

## 二、Husky+lint-staged 本地钩子集成

1. 安装依赖：

   ```bash
   pnpm add -D husky lint-staged
   
   # 安装必要的开发依赖
   pnpm add -D husky lint-staged eslint prettier @typescript-eslint/eslint-plugin @typescript-eslint/parser eslint-config-prettier
   
   # 安装 husky 钩子并初始化
   pnpm exec husky install
   pnpm husky init
   ```

2. 编辑 `.husky/pre-commit` 文件并添加以下内容：

   ```bash
   #!/bin/sh
   pnpm exec lint-staged
   ```

3. 创建 `pre-push` 钩子（可选，验证类型检查和测试），并编辑 `.husky/pre-push` 文件：

   ```bash
   touch .husky/pre-push
   ```

   ```bash
   #!/usr/bin/env sh
   . "$(dirname -- "$0")/_/husky.sh"
   
   # 运行类型检查和测试
   pnpm run typecheck
   pnpm run test
   ```

4. 在 `package.json` 中配置 `lint-staged`，确保它只对暂存区的文件进行处理：

   ```json
   {
     "lint-staged": {
       "*.{ts,tsx,js,jsx}": [
         "eslint --fix",
         "prettier --write"
       ],
       "*.{md,css,scss,json,yml,yaml}": [
         "prettier --write"
       ]
     }
   }
   ```

5. 验证本地钩子是否安装成功

```bash
# 确保脚本可执行
chmod +x .husky/pre-commit
# 添加某个文件到缓存区
git add src/components/MyButton/index.tsx
# 执行pre-commit钩子
git commit -m "test: 测试 pre-commit 钩子"

# 确保脚本可执行
chmod +x .husky/pre-push
# 确保所有更改已提交
git add .
git commit -m "feat: 添加新功能"
# 推送到自己的远程仓库
git push origin xxx
```

### 三、GitHub Actions CI集成

新增 .github/workflows/ci.yml文件内容如下：

```yml
name: CI

on:
  push:
    branches: [main]
  pull_request:

jobs:
  build-and-test:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup PNPM
        uses: pnpm/action-setup@v4
        with:
          version: 9

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: 22
          cache: pnpm

      - name: Install deps
        run: pnpm install --frozen-lockfile

      - name: Lint (ESLint)
        run: pnpm lint

      - name: Lint (Stylelint)
        run: pnpm stylelint

      - name: Format check (Prettier)
        run: pnpm format

      - name: Test
        run: pnpm test

      - name: Build lib
        run: pnpm build

      # 可选：构建 Storybook 文档
      # - name: Build Storybook
      #   run: pnpm build-storybook
```

- 验证CI是否正确集成：提交一个 PR 到 `main` 分支，观察 GitHub Actions CI 是否能正确触发。
